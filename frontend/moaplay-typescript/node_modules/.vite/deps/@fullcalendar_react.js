import { __toESM } from "./chunk-DbKvDyjX.js";
import { Calendar, CustomRenderingStore } from "./internal-5lLRkTvu.js";
import { require_react } from "./react-C7PpavTg.js";
import { require_react_dom } from "./react-dom-DVpBQB8W.js";

//#region node_modules/@fullcalendar/react/dist/index.js
var import_react = /* @__PURE__ */ __toESM(require_react(), 1);
var import_react_dom = /* @__PURE__ */ __toESM(require_react_dom(), 1);
var syncRenderingByDefault = parseInt(String(import_react.version).split(".")[0]) < 18;
var FullCalendar = class extends import_react.Component {
	constructor() {
		super(...arguments);
		this.elRef = (0, import_react.createRef)();
		this.isUpdating = false;
		this.isUnmounting = false;
		this.state = { customRenderingMap: /* @__PURE__ */ new Map() };
		this.requestResize = () => {
			if (!this.isUnmounting) {
				this.cancelResize();
				this.resizeId = requestAnimationFrame(() => {
					this.doResize();
				});
			}
		};
	}
	render() {
		const customRenderingNodes = [];
		for (const customRendering of this.state.customRenderingMap.values()) customRenderingNodes.push(import_react.createElement(CustomRenderingComponent, {
			key: customRendering.id,
			customRendering
		}));
		return import_react.createElement("div", { ref: this.elRef }, customRenderingNodes);
	}
	componentDidMount() {
		this.isUnmounting = false;
		const customRenderingStore = new CustomRenderingStore();
		this.handleCustomRendering = customRenderingStore.handle.bind(customRenderingStore);
		this.calendar = new Calendar(this.elRef.current, Object.assign(Object.assign({}, this.props), { handleCustomRendering: this.handleCustomRendering }));
		this.calendar.render();
		this.calendar.on("_beforeprint", () => {
			(0, import_react_dom.flushSync)(() => {});
		});
		let lastRequestTimestamp;
		customRenderingStore.subscribe((customRenderingMap) => {
			const requestTimestamp = Date.now();
			const isMounting = !lastRequestTimestamp;
			(syncRenderingByDefault || isMounting || this.isUpdating || this.isUnmounting || requestTimestamp - lastRequestTimestamp < 100 ? runNow : import_react_dom.flushSync)(() => {
				this.setState({ customRenderingMap }, () => {
					lastRequestTimestamp = requestTimestamp;
					if (isMounting) this.doResize();
					else this.requestResize();
				});
			});
		});
	}
	componentDidUpdate() {
		this.isUpdating = true;
		this.calendar.resetOptions(Object.assign(Object.assign({}, this.props), { handleCustomRendering: this.handleCustomRendering }));
		this.isUpdating = false;
	}
	componentWillUnmount() {
		this.isUnmounting = true;
		this.cancelResize();
		this.calendar.destroy();
	}
	doResize() {
		this.calendar.updateSize();
	}
	cancelResize() {
		if (this.resizeId !== void 0) {
			cancelAnimationFrame(this.resizeId);
			this.resizeId = void 0;
		}
	}
	getApi() {
		return this.calendar;
	}
};
FullCalendar.act = runNow;
var CustomRenderingComponent = class extends import_react.PureComponent {
	render() {
		const { customRendering } = this.props;
		const { generatorMeta } = customRendering;
		const vnode = typeof generatorMeta === "function" ? generatorMeta(customRendering.renderProps) : generatorMeta;
		return (0, import_react_dom.createPortal)(vnode, customRendering.containerEl);
	}
};
function runNow(f) {
	f();
}

//#endregion
export { FullCalendar as default };
//# sourceMappingURL=@fullcalendar_react.js.map